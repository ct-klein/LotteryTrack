<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="LotteryTracker.App.Views.StatisticsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <!-- Loading Overlay -->
        <ProgressRing
            x:Name="LoadingRing"
            Width="48"
            Height="48"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"/>

        <!-- Main Content -->
        <ScrollViewer x:Name="ContentArea">
            <StackPanel Padding="24" Spacing="24">
                <!-- Header -->
                <TextBlock Text="Statistics" Style="{StaticResource TitleTextBlockStyle}"/>

                <!-- Overall Summary Cards -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Overall Summary" Style="{StaticResource SubtitleTextBlockStyle}"/>
                    <StackPanel Orientation="Horizontal" Spacing="16">
                        <!-- Total Spent -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1" CornerRadius="8" Padding="20" MinWidth="180">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Total Spent" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="TotalSpentText" Style="{StaticResource TitleTextBlockStyle}"/>
                                <TextBlock x:Name="TotalTicketsText" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                        </Border>

                        <!-- Total Won -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1" CornerRadius="8" Padding="20" MinWidth="180">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Total Won" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="TotalWonText" Style="{StaticResource TitleTextBlockStyle}"
                                           Foreground="Green"/>
                                <TextBlock x:Name="WinnersText" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                        </Border>

                        <!-- Net Profit/Loss -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1" CornerRadius="8" Padding="20" MinWidth="180">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Net Profit/Loss" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="NetProfitText" Style="{StaticResource TitleTextBlockStyle}"/>
                            </StackPanel>
                        </Border>

                        <!-- Win Rate -->
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1" CornerRadius="8" Padding="20" MinWidth="180">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Win Rate" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="WinRateText" Style="{StaticResource TitleTextBlockStyle}"/>
                                <TextBlock x:Name="WinRateSubtitleText" Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <!-- Stats by Ticket Type -->
                <Grid ColumnSpacing="24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Scratch-Off Stats -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1" CornerRadius="8" Padding="24">
                        <StackPanel Spacing="16">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Border Width="40" Height="40" CornerRadius="8"
                                        Background="{ThemeResource AccentFillColorDefaultBrush}">
                                    <FontIcon Glyph="&#xE8C6;" FontSize="20" Foreground="White"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Scratch-Off Tickets" Style="{StaticResource SubtitleTextBlockStyle}"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <Grid RowSpacing="12" ColumnSpacing="24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Spacing="2">
                                    <TextBlock Text="Total Tickets" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="ScratchOffTotalText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Spacing="2">
                                    <TextBlock Text="Win Rate" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="ScratchOffWinRateText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Spacing="2">
                                    <TextBlock Text="Total Spent" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="ScratchOffSpentText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="1" Spacing="2">
                                    <TextBlock Text="Total Won" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="ScratchOffWonText" Style="{StaticResource BodyStrongTextBlockStyle}"
                                               Foreground="Green"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Spacing="2">
                                    <TextBlock Text="Net Profit/Loss" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="ScratchOffNetText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Draw Game Stats -->
                    <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1" CornerRadius="8" Padding="24">
                        <StackPanel Spacing="16">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Border Width="40" Height="40" CornerRadius="8"
                                        Background="{ThemeResource AccentFillColorDefaultBrush}">
                                    <FontIcon Glyph="&#xE81C;" FontSize="20" Foreground="White"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Draw Game Tickets" Style="{StaticResource SubtitleTextBlockStyle}"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <Grid RowSpacing="12" ColumnSpacing="24">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Spacing="2">
                                    <TextBlock Text="Total Tickets" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="DrawGameTotalText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Spacing="2">
                                    <TextBlock Text="Win Rate" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="DrawGameWinRateText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Spacing="2">
                                    <TextBlock Text="Total Spent" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="DrawGameSpentText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="1" Spacing="2">
                                    <TextBlock Text="Total Won" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="DrawGameWonText" Style="{StaticResource BodyStrongTextBlockStyle}"
                                               Foreground="Green"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Spacing="2">
                                    <TextBlock Text="Net Profit/Loss" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock x:Name="DrawGameNetText" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Ticket Status Breakdown -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="24">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Ticket Status Breakdown" Style="{StaticResource SubtitleTextBlockStyle}"/>

                        <StackPanel Orientation="Horizontal" Spacing="32">
                            <!-- Pending -->
                            <StackPanel Spacing="4" MinWidth="100">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Ellipse Width="12" Height="12" Fill="Orange"/>
                                    <TextBlock Text="Pending" Style="{StaticResource BodyTextBlockStyle}"/>
                                </StackPanel>
                                <TextBlock x:Name="PendingCountText" Style="{StaticResource TitleTextBlockStyle}"
                                           Margin="20,0,0,0"/>
                            </StackPanel>

                            <!-- Winners -->
                            <StackPanel Spacing="4" MinWidth="100">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Ellipse Width="12" Height="12" Fill="Green"/>
                                    <TextBlock Text="Winners" Style="{StaticResource BodyTextBlockStyle}"/>
                                </StackPanel>
                                <TextBlock x:Name="WinnerCountText" Style="{StaticResource TitleTextBlockStyle}"
                                           Margin="20,0,0,0"/>
                            </StackPanel>

                            <!-- Losers -->
                            <StackPanel Spacing="4" MinWidth="100">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Ellipse Width="12" Height="12" Fill="Gray"/>
                                    <TextBlock Text="No Win" Style="{StaticResource BodyTextBlockStyle}"/>
                                </StackPanel>
                                <TextBlock x:Name="LoserCountText" Style="{StaticResource TitleTextBlockStyle}"
                                           Margin="20,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Stats by Game -->
                <Border x:Name="GameStatsSection" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="24">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Statistics by Game" Style="{StaticResource SubtitleTextBlockStyle}"/>

                        <ListView x:Name="GameStatsListView" SelectionMode="None"
                                  ContainerContentChanging="GameStatsListView_ContainerContentChanging">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8,12" ColumnSpacing="24">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="200"/>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="100"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock x:Name="GameNameText" Style="{StaticResource BodyStrongTextBlockStyle}"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock x:Name="GameTicketsText" Grid.Column="1"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock x:Name="GameSpentText" Grid.Column="2"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock x:Name="GameWonText" Grid.Column="3"
                                                   Foreground="Green" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="GameWinRateText" Grid.Column="4"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                            <ListView.Header>
                                <Grid Padding="8,8,8,4" ColumnSpacing="24"
                                      BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                      BorderThickness="0,0,0,1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Game" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="1" Text="Tickets" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="2" Text="Spent" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="3" Text="Won" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="4" Text="Win Rate" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </Grid>
                            </ListView.Header>
                        </ListView>

                        <TextBlock x:Name="NoGamesText" Text="No game data available yet"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Visibility="Collapsed"/>
                    </StackPanel>
                </Border>

                <!-- Monthly Trend -->
                <Border x:Name="MonthlyStatsSection" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="24">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Monthly Trend (Last 12 Months)" Style="{StaticResource SubtitleTextBlockStyle}"/>

                        <ListView x:Name="MonthlyStatsListView" SelectionMode="None"
                                  ContainerContentChanging="MonthlyStatsListView_ContainerContentChanging">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="8,12" ColumnSpacing="24">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="100"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock x:Name="MonthText" Style="{StaticResource BodyStrongTextBlockStyle}"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock x:Name="MonthTicketsText" Grid.Column="1"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock x:Name="MonthSpentText" Grid.Column="2"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock x:Name="MonthWonText" Grid.Column="3"
                                                   Foreground="Green" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="MonthNetText" Grid.Column="4"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                            <ListView.Header>
                                <Grid Padding="8,8,8,4" ColumnSpacing="24"
                                      BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                      BorderThickness="0,0,0,1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="80"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Month" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="1" Text="Tickets" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="2" Text="Spent" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="3" Text="Won" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="4" Text="Net" Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </Grid>
                            </ListView.Header>
                        </ListView>

                        <TextBlock x:Name="NoMonthlyText" Text="No monthly data available yet"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Visibility="Collapsed"/>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
